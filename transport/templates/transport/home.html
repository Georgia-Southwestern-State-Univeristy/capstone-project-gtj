{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="transport-container">
    <div class="header">
        <div>GTJGo Logo</div>
        <div class="nav">
            <a href="{% url 'main:home' %}">Home</a>
            <a href="{% url 'planes:home' %}">Flights</a>
            <a href="{% url 'hotels:home' %}">Hotels</a>
            <a href="{% url 'transport:home' %}">Transport</a>
            {% if user.is_authenticated %}
                <a href="{% url 'favorites:view_favorites' %}">Favorites</a>
            {% endif %}
        </div>
    </div>

    <div class="search-container">
        <h1>Find Public Transportation</h1>
        <form method="GET" action="{% url 'transport:search_transit' %}" class="search-form">
            <div class="input-container">
                <input type="text" 
                       name="city" 
                       placeholder="Enter city name" 
                       required 
                       class="search-input">
            </div>
            <button type="submit" class="search-button">Search Transportation</button>
        </form>
    </div>

    {% if error %}
        <div class="error-message">
            {{ error }}
        </div>
    {% endif %}

    {% if transport_types %}
        <div class="results-container">
            {% for transport in transport_types %}
                <div class="transport-card">
                    <h2>{{ transport.get_type_display }}</h2>
                    <h3>{{ transport.name }}</h3>
                    <p>{{ transport.description }}</p>
                    <div class="transport-details">
                        <p><strong>Operating Hours:</strong> {{ transport.operating_hours }}</p>
                        <p><strong>Price Info:</strong> {{ transport.price_info }}</p>
                        {% if transport.website %}
                            <a href="{{ transport.website }}" target="_blank" class="website-link">Official Website</a>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>

        {% if stations %}
            <div class="map-container">
                <h2>Nearby Stations</h2>
                <div id="map" style="height: 400px;"></div>
            </div>
        {% endif %}
    {% endif %}
</div>

<style>
.transport-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.search-container {
    background-color: rgb(249, 181, 172);
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    text-align: center;
}

.search-form {
    display: flex;
    gap: 10px;
    justify-content: center;
    align-items: center;
}

.search-input {
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    width: 300px;
}

.search-button {
    padding: 10px 20px;
    background-color: #333;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.transport-card {
    background-color: white;
    border-radius: 10px;
    padding: 20px;
    margin: 20px 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.transport-details {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #eee;
}

.website-link {
    display: inline-block;
    padding: 5px 10px;
    background-color: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    margin-top: 10px;
}

.error-message {
    background-color: #fee;
    color: #c00;
    padding: 10px;
    border-radius: 5px;
    margin: 20px 0;
}
</style>

{% if stations %}
<script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}"></script>
<script>
function initMap() {
    const map = new google.maps.Map(document.getElementById('map'), {
        zoom: 12,
        center: { 
            lat: {{ stations.first.latitude|stringformat:"f" }}, 
            lng: {{ stations.first.longitude|stringformat:"f" }} 
        }
    });

    {% for station in stations %}
        new google.maps.Marker({
            position: { 
                lat: {{ station.latitude|stringformat:"f" }}, 
                lng: {{ station.longitude|stringformat:"f" }} 
            },
            map: map,
            title: "{{ station.name }}"
        });
    {% endfor %}
}

window.onload = initMap;
</script>
{% endif %}
{% endblock %}